---
// src/pages/admin.astro
import Layout from '../layouts/Layout.astro';
---
<Layout 
    title="Acceso Clientes - Emmanuel Contreras"
    description="Accede a tu panel de cliente para gestionar tus proyectos de desarrollo web."
    hideHeaderFooter={true}
>
    <div class="admin-container">
        <div class="admin-card">
            <h1 class="admin-card__title">Acceso Clientes</h1>
            <p class="admin-card__subtitle">Ingresa para ver tus proyectos</p>
            <form id="login-form" class="admin-form">
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn--primary btn--block">Ingresar</button>
                </div>
                <p id="error-message" class="error-message"></p>
            </form>
        </div>
    </div>
</Layout>

<script is:inline>
    import { auth } from '../firebase/client';
    import { signInWithEmailAndPassword, onAuthStateChanged } from "firebase/auth";

    const loginForm = document.getElementById('login-form');
    const errorMessage = document.getElementById('error-message');

    // Redirigir si el usuario ya está logueado
    onAuthStateChanged(auth, (user) => {
        if (user) {
            window.location.href = '/dashboard';
        }
    });

    if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');

            if (emailInput && passwordInput) {
                const email = emailInput.value;
                const password = passwordInput.value;

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    // onAuthStateChanged se encargará de la redirección al dashboard
                } catch (error) {
                    console.error("Error de autenticación:", error.message);
                    if (errorMessage) {
                        errorMessage.textContent = 'Correo o contraseña incorrectos.';
                        errorMessage.style.display = 'block';
                    }
                }
            }
        });
    }
</script>
